<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;">
    <title>Prendre Rendez-vous ‚Äî TravelVLM</title>
  <link rel="stylesheet" href="style/style.css">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:#f6f8fb;color:#222}
    header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:16px 20px;box-shadow:0 4px 15px rgba(0,0,0,0.2);position:sticky;top:0;z-index:100}
    .header-top{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:20px;flex-wrap:wrap}
    .header-top a{color:#fff;text-decoration:none;font-weight:bold;display:flex;align-items:center;gap:8px}
    .header-top nav{display:flex;gap:16px;align-items:center}
    .header-top nav a{font-weight:500;padding:6px 12px;border-radius:4px;transition:background 0.3s}
    .header-top nav a:hover{background:rgba(255,255,255,0.2)}
    #secretEgg{position:fixed;top:12px;right:12px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:20px;border-radius:50%;cursor:pointer;z-index:1200;opacity:0.06;transition:opacity .18s ease, transform .18s ease;user-select:none}
    #secretEgg:hover{opacity:0.95;transform:scale(1.08)}
    #secretEgg.revealed{opacity:0.95}
    #trophyBtn{position:fixed;top:12px;right:64px;z-index:1201;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:linear-gradient(135deg,#ffd700,#ff9800);box-shadow:0 6px 18px rgba(0,0,0,0.15);cursor:pointer;text-decoration:none;color:#333;opacity:0.9;font-size:18px}
    #trophyBtn:hover{transform:scale(1.06)}
    main{max-width:1000px;margin:30px auto;padding:16px}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:20px}
    .card h2{margin:0 0 10px;color:#333}
    .card h3{margin:0 0 8px;color:#333}
    .card p{margin:8px 0;color:#666}
    label{display:block;margin:12px 0 6px;font-weight:600;color:#333}
    input,select,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;font-family:inherit;box-sizing:border-box}
    input:focus,select:focus,textarea:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1)}
    textarea{min-height:120px;resize:vertical}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
    @media(max-width:600px){.form-grid{grid-template-columns:1fr}}
    .btn{padding:12px 16px;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:all 0.3s}
    .btn-primary{background:#667eea;color:#fff;box-shadow:0 4px 15px rgba(102,126,234,0.4)}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,0.6)}
    .btn-ghost{background:transparent;border:1px solid #ddd;color:#333}
    .btn-ghost:hover{background:#f5f5f5}
    .checkbox-group{display:flex;align-items:center;margin:12px 0}
    .checkbox-group input{width:auto;margin-right:8px}
    .checkbox-group label{margin:0;display:inline;font-weight:normal}
    .status{margin-top:16px;padding:12px;border-radius:8px;font-weight:600;display:none}
    .status-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
    .status-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
    .info-box{background:#f0f4ff;border-left:4px solid #667eea;padding:12px;border-radius:0 6px 6px 0;margin:12px 0}
    .info-box strong{color:#667eea}
    footer{background:#333;color:#fff;text-align:center;padding:30px 20px;margin-top:40px}
    footer a{color:#667eea;text-decoration:none}
    footer a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <!-- Easter eggs -->
  <div id="secretEgg" role="button" aria-label="Oeuf secret">ü•ö</div>
  <a id="trophyBtn" href="trophe.html" title="Troph√©es">üèÜ</a>

  <!-- HEADER -->
  <header>
    <div class="header-top">
      <a href="index.html">‚úàÔ∏è TravelVLM</a>
      <nav>
        <a href="index.html">Accueil</a>
        <a href="rendezvous.html">Rendez-vous</a>
        <a href="commentaire.html">Commentaires</a>
        <a href="trophe.html">Troph√©es</a>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <div class="card">
      <h2>Demander un Rendez-vous</h2>
      <p>Remplissez le formulaire ci-dessous pour demander un rendez-vous avec nos conseillers en voyage. Nous vous recontacterons d√®s que possible.</p>
      <div class="info-box">
        <strong>‚ÑπÔ∏è Traitement local :</strong> 
      </div>
    </div>

    <div class="card">
      <form id="rendezvousForm" action="#" method="POST" novalidate>
        <div class="form-grid">
          <div>
            <label for="fname">Pr√©nom *</label>
            <input type="text" id="fname" name="firstname" required placeholder="Jean">
          </div>
          <div>
            <label for="lname">Nom *</label>
            <input type="text" id="lname" name="lastname" required placeholder="Dupont">
          </div>
        </div>

        <div class="form-grid">
          <div>
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required placeholder="jean@example.com">
          </div>
          <div>
            <label for="phone">T√©l√©phone</label>
            <input type="tel" id="phone" name="phone" placeholder="+33 (0)1 ******** 68">
          </div>
        </div>

        <div class="form-grid">
          <div>
            <label for="rdvdate">Date souhait√©e *</label>
            <input type="date" id="rdvdate" name="preferred_date" required>
          </div>
          <div>
            <label for="rdvtime">Heure souhait√©e</label>
            <input type="time" id="rdvtime" name="preferred_time">
          </div>
        </div>

        <div>
          <label for="subject">Type de voyage/sujet *</label>
          <select id="subject" name="subject" required>
            <option value="">-- Choisir un sujet --</option>
            <option value="Voyage de luxe">Voyage de luxe</option>
            <option value="Voyage du monde">Tour du monde</option>
            <option value="Voyage professionnel">Voyage professionnel</option>
            <option value="Voyage solidaire">Voyage pour moins d√©munis</option>
            <option value="Autre">Autre</option>
          </select>
        </div>

        <div style="margin-top:12px">
          <label for="message">Message/Commentaires</label>
          <textarea id="message" name="message" placeholder="D√©crivez votre projet de voyage..."></textarea>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="newsletter" name="newsletter">
          <label for="newsletter">M'inscrire √† la newsletter TravelVLM</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="consent" name="consent" required>
          <label for="consent">J'accepte que mes donn√©es soient utilis√©es pour traiter ma demande de rendez-vous *</label>
        </div>

        <div style="display:flex;gap:12px;margin-top:20px;flex-wrap:wrap">
          <button type="submit" class="btn btn-primary">Envoyer la demande</button>
          <button type="reset" class="btn btn-ghost">R√©initialiser</button>
        </div>
      </form>

      <div id="formStatus" class="status"></div>
    </div>

    <div class="card" style="background:#f0f4ff;border-left:4px solid #667eea">
      <h3>Besoin d'aide ?</h3>
      <p>
        <strong>Email :</strong> contact@travelvlm.local<br>
        <strong>T√©l√©phone :</strong> +33 (0)1 ******** 68 (7j/7, 9h-19h)<br>
        <strong>Chat :</strong> Disponible via l'application mobile
      </p>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    <div style="max-width:1200px;margin:0 auto">
      <div style="margin-bottom:20px">
        <a href="index.html">Accueil</a> |
        <a href="rendezvous.html">Rendez-vous</a> |
        <a href="commentaire.html">Commentaires</a> |
        <a href="trophe.html">Troph√©es</a>
      </div>
      <p>&copy; 2025 TravelVLM - L√† o√π vos r√™ves deviennent r√©alit√©</p>
      <p style="margin-top:15px;font-size:13px;color:#999">
        G√©r√©e par une √©quipe de passionn√©s qui r√™vent de voyages, destin√©e √† tous ceux qui cherchent l'aventure, la d√©couverte et le confort.
      </p>
    </div>
  </footer>

  <script src="js/dompurify.min.js"></script>
  <script src="js/sanitize.js"></script>
  <script src="auth-ui.js"></script>
  <script>
    // Gestion locale du formulaire de rendez-vous (aucun envoi vers un service externe)
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('rendezvousForm');
      const statusDiv = document.getElementById('formStatus');

      // Set minimum date to today
      const today = new Date().toISOString().split('T')[0];
      const rdvDateEl = document.getElementById('rdvdate');
      if (rdvDateEl) rdvDateEl.setAttribute('min', today);

      function showStatus(message, success = true) {
        statusDiv.className = 'status ' + (success ? 'status-success' : 'status-error');
        statusDiv.textContent = message;
        statusDiv.style.display = 'block';
      }

      function collectFormData(frm) {
        const fd = new FormData(frm);
        const obj = {};
        fd.forEach((v, k) => {
          if (obj.hasOwnProperty(k)) {
            // Handle multiple values
            if (!Array.isArray(obj[k])) obj[k] = [obj[k]];
            obj[k].push(v);
          } else {
            obj[k] = v;
          }
        });
        obj.submittedAt = new Date().toISOString();
        return obj;
      }

      function saveSubmission(entry) {
        try {
          const key = 'travelvlm_rendezvous_submissions_v1';
          const raw = localStorage.getItem(key);
          const arr = raw ? JSON.parse(raw) : [];
          arr.push(entry);
          localStorage.setItem(key, JSON.stringify(arr));
          return true;
        } catch (err) {
          console.error('Erreur sauvegarde rendezvous:', err);
          return false;
        }
      }

      function downloadJSON(obj, filename = 'rendezvous.json') {
        const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        statusDiv.style.display = 'none';

        // Basic validation: consent required
        const consent = form.querySelector('[name="consent"]');
        if (consent && !consent.checked) {
          showStatus('Veuillez accepter le traitement des donn√©es (case obligatoire).', false);
          return;
        }

        const data = collectFormData(form);
        const ok = saveSubmission(data);
        if (ok) {
          showStatus('‚úÖ Votre demande a √©t√© sauvegard√©e localement. Vous pouvez t√©l√©charger une copie.', true);
          // Offer download immediately
          setTimeout(() => downloadJSON(data, 'rendezvous-' + Date.now() + '.json'), 200);
          form.reset();
          if (rdvDateEl) rdvDateEl.setAttribute('min', today);
        } else {
          showStatus('‚ùå Impossible de sauvegarder la demande localement (localStorage indisponible).', false);
        }
      });
    });

    // Easter egg script
    (function(){
      const EGG_KEY = 'traveldream_easter_egg_v1';
      const el = document.getElementById('secretEgg');
      if(!el) return;
      let state = parseInt(localStorage.getItem ? localStorage.getItem(EGG_KEY) || '0' : '0', 10);
      const labels = ['ü•ö','üê≤','üêâ'];
      function render(){ el.textContent = labels[state] || labels[0]; if(state>0) el.classList.add('revealed'); else el.classList.remove('revealed'); }
      function animatePop(){ el.style.transform='scale(1.25)'; setTimeout(()=>el.style.transform='scale(1)',160); }
      el.addEventListener('click', function(e){ e.preventDefault(); state = (state + 1) % labels.length; if(localStorage) localStorage.setItem(EGG_KEY, String(state)); render(); animatePop(); });
      let pressTimer=null;
      el.addEventListener('pointerdown', ()=>{ pressTimer = setTimeout(()=>{ state=0; if(localStorage) localStorage.setItem(EGG_KEY,'0'); render(); alert('Oeuf r√©initialis√©'); }, 1600); });
      el.addEventListener('pointerup', ()=>{ if(pressTimer){ clearTimeout(pressTimer); pressTimer=null } });
      render();
    })();

    // Cookie banner
    (function(){
      const key='traveldream_cookies_v1';
      function getCookie(){ try{ return localStorage.getItem(key); }catch(e){ return null; } }
      function setCookie(v){ try{ localStorage.setItem(key, v); }catch(e){} }
      const v = getCookie();
      if(!v){
        const consent = confirm('TravelVLM utilise des cookies. Acceptez-vous?');
        if(consent) setCookie('accepted');
        else setCookie('rejected');
      }
    })();
  </script>
</body>
</html>
